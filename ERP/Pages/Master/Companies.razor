@page "/companies"
@using ERP.Models.Entities
@using ERP.Components.Shared.Grid
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Calendars

<PageTitle>Companies - Transport ERP</PageTitle>

<div class="page-container">
    <!-- Breadcrumb -->
    <Breadcrumb Items="@breadcrumbItems" />

    <!-- Manual Form Section -->
    @if (showForm)
    {
        <div class="form-container fade-in">
            <div class="form-header">
                <h3>@(currentCompany?.CompanyID == 0 ? "Add New Company" : "Edit Company")</h3>
                <SfButton CssClass="e-outline" IconCss="bi bi-x" OnClick="CloseForm">Close</SfButton>
            </div>

            <EditForm Model="@currentCompany" OnValidSubmit="SaveCompany">
                <DataAnnotationsValidator />
                
                <div class="row g-3">
                    <!-- Company Name -->
                    <div class="col-md-6">
                        <SfTextBox @bind-Value="currentCompany.CompanyName" 
                                   Placeholder="Company Name *"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                        <ValidationMessage For="@(() => currentCompany.CompanyName)" />
                    </div>

                    <!-- Short Code -->
                    <div class="col-md-6">
                        <SfTextBox @bind-Value="currentCompany.ShortCode" 
                                   Placeholder="Short Code"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                    </div>

                    <!-- GST NO -->
                    <div class="col-md-6">
                        <SfTextBox @bind-Value="currentCompany.GSTNO" 
                                   Placeholder="GST Number"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                    </div>

                    <!-- PAN NO -->
                    <div class="col-md-6">
                        <SfTextBox @bind-Value="currentCompany.PANNO" 
                                   Placeholder="PAN Number"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                    </div>

                    <!-- Email -->
                    <div class="col-md-6">
                        <SfTextBox @bind-Value="currentCompany.Mail" 
                                   Placeholder="Email *"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                        <ValidationMessage For="@(() => currentCompany.Mail)" />
                    </div>

                    <!-- Mobile -->
                    <div class="col-md-6">
                        <SfTextBox @bind-Value="currentCompany.MobileNo" 
                                   Placeholder="Mobile Number"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                    </div>

                    <!-- Start Date -->
                    <div class="col-md-6">
                        <SfDatePicker TValue="DateTime?" @bind-Value="currentCompany.StartDate" 
                                     Placeholder="Start Date"
                                     FloatLabelType="FloatLabelType.Auto"
                                     CssClass="e-outline">
                        </SfDatePicker>
                    </div>

                    <!-- End Date -->
                    <div class="col-md-6">
                        <SfDatePicker TValue="DateTime?" @bind-Value="currentCompany.EndDate" 
                                     Placeholder="End Date"
                                     FloatLabelType="FloatLabelType.Auto"
                                     CssClass="e-outline">
                        </SfDatePicker>
                    </div>

                    <!-- Address -->
                    <div class="col-md-12">
                        <SfTextBox @bind-Value="currentCompany.CompanyAddress" 
                                   Multiline="true"
                                   Placeholder="Address"
                                   FloatLabelType="FloatLabelType.Auto"
                                   CssClass="e-outline">
                        </SfTextBox>
                    </div>

                    <!-- Is Active -->
                    <div class="col-md-12">
                        <SfCheckBox @bind-Checked="currentCompany.IsActive" Label="Active" TChecked="bool?"></SfCheckBox>
                    </div>
                </div>

                <div class="sticky-footer">
                    <SfButton CssClass="e-primary" IconCss="bi bi-save" Type="Submit">
                        @(currentCompany?.CompanyID == 0 ? "Save Company" : "Update Company")
                    </SfButton>
                    <SfButton CssClass="e-outline" OnClick="CloseForm">
                        Cancel
                    </SfButton>
                </div>
            </EditForm>
        </div>
    }

    <!-- Common Grid -->
    @if (!showForm)
    {
        <CommonGrid TEntity="ERP.Models.Entities.Company"
                    GridTitle="All Companies"
                    EntityName="Company"
                    HelpText="Manage company information, including GST, PAN, and contact details."
                    DataSource="@companies"
                    CanAdd="@(currentRights?.IsAdd ?? true)"
                    CanEdit="@(currentRights?.IsEdit ?? true)"
                    CanDelete="@(currentRights?.IsDelete ?? true)"
                    OnAdd="OpenAddForm"
                    OnEdit="OpenEditForm"
                    OnDelete="DeleteCompany">
            <GridColumns>
                <GridColumn Field="@nameof(ERP.Models.Entities.Company.CompanyID)" HeaderText="ID" Width="80" IsPrimaryKey="true"></GridColumn>
                <GridColumn Field="@nameof(ERP.Models.Entities.Company.CompanyName)" HeaderText="Company Name" Width="200"></GridColumn>
                <GridColumn Field="@nameof(ERP.Models.Entities.Company.ShortCode)" HeaderText="Short Code" Width="120"></GridColumn>
                <GridColumn Field="@nameof(ERP.Models.Entities.Company.GSTNO)" HeaderText="GST NO" Width="150"></GridColumn>
                <GridColumn Field="@nameof(ERP.Models.Entities.Company.Mail)" HeaderText="Email" Width="200"></GridColumn>
                <GridColumn Field="@nameof(ERP.Models.Entities.Company.IsActive)" HeaderText="Status" Width="100">
                    <Template>
                        @{
                            var company = context as ERP.Models.Entities.Company;
                            <span class="@(company?.IsActive ?? false ? "badge-success" : "badge-danger")">
                                @(company?.IsActive ?? false ? "Active" : "Inactive")
                            </span>
                        }
                    </Template>
                </GridColumn>
            </GridColumns>
        </CommonGrid>
    }
</div>
